<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hangul Recognition Game</title>
    <style>
        html {
            height: 100%;
            overflow: hidden;
        }
        
        body {
            font-family: Arial, sans-serif;
            background-color: #f9f9f9;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: flex-start;
            height: 100%;
            overflow-y: auto;
            min-height: 100vh;
        }
        
        .container {
            text-align: center;
            width: 900px;
            padding: 20px;
            transform-origin: top center;
            margin: 20px auto;
        }
        
        h1 {
            margin-bottom: 20px;
            font-size: 26px;
        }
        
        .character-container {
            position: relative;
            display: inline-block;
            margin: 25px 0 5px;
        }
        
        .character-display {
            font-size: 80px;
            height: 100px;
            cursor: pointer;
            line-height: 1;
        }
        
        .hover-tooltip {
            position: absolute;
            top: -32px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 16px;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }
        
        .character-container:hover .hover-tooltip {
            opacity: 1;
        }
        
        .input-area {
            margin-bottom: 15px;
        }
        
        input[type="text"] {
            padding: 10px;
            font-size: 16px;
            width: 350px;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        
        .feedback {
            color: red;
            height: 20px;
            margin-top: -17px;
            margin-bottom: 15px;
            font-size: 17px;
        }
        
        .options {
            background-color: #e9e3e3;
            padding: 10px;
            margin-top: 20px;
            border-radius: 5px;
            width: 100%;
        }
        
        .options-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .options-title {
            font-size: 24px;
            color: #7d5858;
        }
        
        .options-controls {
            display: flex;
            align-items: center;
        }
        
        .options-controls a {
            color: #4a90e2;
            text-decoration: none;
            margin: 0 10px;
            cursor: pointer;
        }
        
        .options-controls span {
            color: #999;
        }
        
        .font-size-control {
            display: flex;
            align-items: center;
            margin-left: 20px;
        }
        
        .font-size-control label {
            margin-right: 10px;
        }
        
        .hangul-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 6px;
            margin: 0 auto;
        }
        
        .grid-column {
            text-align: center;
        }
        
        .column-checkbox {
            margin: 3px;
        }
        
        .hangul-cell {
            border: 1px solid #ddd;
            padding: 5px;
            margin-bottom: 3px;
            border-radius: 3px;
        }
        
        .character {
            font-size: 28px;
            font-weight: bold;
            transition: font-size 0.3s;
            margin: 0;
            line-height: 1.2;
        }
        
        .romanization {
            font-size: 12px;
            color: #666;
            transition: font-size 0.3s;
            margin: 0;
            line-height: 1;
        }
        
        .instruction {
            font-size: 14px;
        }

        @media (max-width: 480px) {
            .hangul-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Hangul Recognition Game</h1>
        
        <div class="character-container">
            <div class="hover-tooltip" id="hoverTooltip"></div>
            <div class="character-display" id="currentCharacter"></div>
        </div>
        
        <div class="input-area">
            <div class="feedback" id="feedback"></div>
            <input type="text" id="userInput" placeholder="Type romanization here" autocomplete="off">
            <div class="instruction">Type the romanization of the Hangul character. Hover over it if you forgot the answer.</div>
        </div>
        
        <div class="options">
            <div class="options-header">
                <div class="options-title">Options</div>
                <div class="options-controls">
                    <a id="checkAll">check all</a><span> | </span><a id="uncheckAll">uncheck all</a>
                    <div class="font-size-control">
                        <label for="fontSizeSlider">Font Size:</label>
                        <input type="range" id="fontSizeSlider" min="18" max="40" value="28" step="2">
                        <span id="fontSizeValue">28px</span>
                    </div>
                </div>
            </div>
            
            <div class="hangul-grid" id="hangulGrid"></div>
        </div>
    </div>

    <script>
        const hangulChars = [
            { char: 'ㅏ', romanization: 'a', column: 0 },
            { char: 'ㅓ', romanization: 'eo', column: 0 },
            { char: 'ㅗ', romanization: 'o', column: 0 },
            { char: 'ㅜ', romanization: 'u', column: 0 },
            { char: 'ㅡ', romanization: 'eu', column: 0 },
            { char: 'ㅣ', romanization: 'i', column: 0 },
            { char: 'ㅐ', romanization: 'ae', column: 1 },
            { char: 'ㅔ', romanization: 'e', column: 1 },
            { char: 'ㅚ', romanization: 'oe', column: 1 },
            { char: 'ㅟ', romanization: 'wi', column: 1 },
            { char: 'ㅢ', romanization: 'ui', column: 1 },
            { char: 'ㅑ', romanization: 'ya', column: 2 },
            { char: 'ㅕ', romanization: 'yeo', column: 2 },
            { char: 'ㅛ', romanization: 'yo', column: 2 },
            { char: 'ㅠ', romanization: 'yu', column: 2 },
            { char: 'ㅒ', romanization: 'yae', column: 2 },
            { char: 'ㅖ', romanization: 'ye', column: 2 },
            { char: 'ㅘ', romanization: 'wa', column: 3 },
            { char: 'ㅙ', romanization: 'wae', column: 3 },
            { char: 'ㅝ', romanization: 'wo', column: 3 },
            { char: 'ㅞ', romanization: 'we', column: 3 },
            { char: 'ㄱ', romanization: ['g', 'k'], column: 4 },
            { char: 'ㄴ', romanization: 'n', column: 4 },
            { char: 'ㄷ', romanization: ['d', 't'], column: 4 },
            { char: 'ㄹ', romanization: ['r', 'l'], column: 4 },
            { char: 'ㅁ', romanization: 'm', column: 4 },
            { char: 'ㅂ', romanization: ['b', 'p'], column: 4 },
            { char: 'ㅅ', romanization: 's', column: 4 },
            { char: 'ㅇ', romanization: 'ng', column: 5 },
            { char: 'ㅈ', romanization: 'j', column: 5 },
            { char: 'ㅊ', romanization: 'ch', column: 5 },
            { char: 'ㅋ', romanization: 'k', column: 5 },
            { char: 'ㅌ', romanization: 't', column: 5 },
            { char: 'ㅍ', romanization: 'p', column: 5 },
            { char: 'ㅎ', romanization: 'h', column: 5 },
            { char: 'ㄲ', romanization: 'kk', column: 6 },
            { char: 'ㄸ', romanization: 'tt', column: 6 },
            { char: 'ㅃ', romanization: 'pp', column: 6 },
            { char: 'ㅆ', romanization: 'ss', column: 6 },
            { char: 'ㅉ', romanization: 'jj', column: 6 }
        ];

        let currentPool = [];
        let currentCharIndex = 0;
        let selectedColumns = [0];
        let checkboxes = [];
        let currentInputExpected = "";
        let currentFontSize = 28;
        let currentRomanizationSize = 13;
        const REFERENCE_WIDTH = 1706.67;
        const REFERENCE_HEIGHT = 960;
        let currentScale = 1;

        function updatePageScale() {
            const container = document.querySelector('.container');
            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight;
            
            const widthScale = viewportWidth / REFERENCE_WIDTH;
            const heightScale = viewportHeight / REFERENCE_HEIGHT;
            currentScale = Math.min(widthScale, heightScale, 1.5);
            if (currentScale < 0.5) currentScale = 0.5;
            
            container.style.transform = `scale(${currentScale})`;
            
            const scaledHeight = container.offsetHeight * currentScale;
            const availableSpace = viewportHeight - (scaledHeight + 40);
            container.style.marginBottom = availableSpace > 0 ? `${availableSpace}px` : '0';
        }

        function setupHoverTooltip() {
            const charContainer = document.querySelector('.character-container');
            const tooltip = document.getElementById('hoverTooltip');
            
            charContainer.addEventListener('mouseenter', () => {
                if (currentPool.length > 0 && currentCharIndex < currentPool.length) {
                    const currentChar = currentPool[currentCharIndex];
                    const tooltipText = Array.isArray(currentChar.romanization) 
                        ? currentChar.romanization.join(' or ') 
                        : currentChar.romanization;
                    tooltip.textContent = tooltipText;
                }
            });
        }

        function createHangulGrid() {
            const grid = document.getElementById('hangulGrid');
            const columns = [...new Set(hangulChars.map(char => char.column))];
            
            columns.forEach(colNum => {
                const column = document.createElement('div');
                column.className = 'grid-column';
                
                const checkboxDiv = document.createElement('div');
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.className = 'column-checkbox';
                checkbox.dataset.column = colNum;
                if (colNum === 0) checkbox.checked = true;
                
                checkbox.addEventListener('change', () => updateSelectedColumns());
                checkboxDiv.appendChild(checkbox);
                column.appendChild(checkboxDiv);
                checkboxes.push(checkbox);
                
                hangulChars.filter(char => char.column === colNum).forEach(charObj => {
                    const cell = document.createElement('div');
                    cell.className = 'hangul-cell';
                    
                    const charDiv = document.createElement('div');
                    charDiv.className = 'character';
                    charDiv.textContent = charObj.char;
                    
                    const romDiv = document.createElement('div');
                    romDiv.className = 'romanization';
                    romDiv.textContent = Array.isArray(charObj.romanization) 
                        ? charObj.romanization.join('/') 
                        : charObj.romanization;
                    
                    cell.appendChild(charDiv);
                    cell.appendChild(romDiv);
                    column.appendChild(cell);
                });
                
                grid.appendChild(column);
            });
        }

        function updateSelectedColumns() {
            selectedColumns = checkboxes.filter(checkbox => checkbox.checked)
                                      .map(checkbox => parseInt(checkbox.dataset.column));
            if (selectedColumns.length === 0) {
                selectedColumns = [0];
                checkboxes[0].checked = true;
            }
            createPool();
        }

        function createPool() {
            currentPool = hangulChars.filter(char => selectedColumns.includes(char.column));
            shuffleArray(currentPool);
            currentCharIndex = 0;
            displayCurrentCharacter();
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function displayCurrentCharacter() {
            if (currentPool.length === 0 || currentCharIndex >= currentPool.length) {
                createPool();
                return;
            }
            
            const charDisplay = document.getElementById('currentCharacter');
            charDisplay.textContent = currentPool[currentCharIndex].char;
            
            const tooltip = document.getElementById('hoverTooltip');
            const currentChar = currentPool[currentCharIndex];
            const tooltipText = Array.isArray(currentChar.romanization) 
                ? currentChar.romanization.join(' or ') 
                : currentChar.romanization;
            tooltip.textContent = tooltipText;
            
            currentInputExpected = Array.isArray(currentChar.romanization) 
                ? currentChar.romanization[0] 
                : currentChar.romanization;
            
            document.getElementById('userInput').value = '';
            document.getElementById('feedback').textContent = '';
            setTimeout(() => document.getElementById('userInput').focus(), 50);
        }

        function checkDynamicInput(input) {
            const currentChar = currentPool[currentCharIndex];
            const correctAnswers = Array.isArray(currentChar.romanization) 
                ? currentChar.romanization 
                : [currentChar.romanization];
            const feedback = document.getElementById('feedback');
            
            const possiblyCorrect = correctAnswers.some(answer => 
                answer.toLowerCase().startsWith(input.toLowerCase()));
            
            if (possiblyCorrect) {
                if (correctAnswers.some(answer => answer.toLowerCase() === input.toLowerCase())) {
                    setTimeout(() => {
                        currentCharIndex++;
                        displayCurrentCharacter();
                    }, 200);
                }
                feedback.textContent = '';
            } else {
                feedback.textContent = correctAnswers.join(' or ');
                setTimeout(() => document.getElementById('userInput').value = '', 800);
            }
        }

        function updateFontSize(size) {
            currentFontSize = size;
            currentRomanizationSize = size * 0.46;
            document.getElementById('fontSizeValue').textContent = size + 'px';
            
            document.querySelectorAll('.character').forEach(elem => 
                elem.style.fontSize = size + 'px');
            document.querySelectorAll('.romanization').forEach(elem => 
                elem.style.fontSize = currentRomanizationSize + 'px');
        }

        function initGame() {
            createHangulGrid();
            document.getElementById('userInput').addEventListener('input', (e) => 
                checkDynamicInput(e.target.value));
            setupHoverTooltip();
            
            document.getElementById('checkAll').addEventListener('click', () => {
                checkboxes.forEach(checkbox => checkbox.checked = true);
                updateSelectedColumns();
            });
            
            document.getElementById('uncheckAll').addEventListener('click', () => {
                checkboxes.forEach(checkbox => checkbox.checked = false);
                updateSelectedColumns();
            });
            
            const fontSizeSlider = document.getElementById('fontSizeSlider');
            fontSizeSlider.addEventListener('input', (e) => 
                updateFontSize(parseInt(e.target.value)));
            
            createPool();
            updateFontSize(28);
            fontSizeSlider.value = 28;
            
            updatePageScale();
            window.addEventListener('resize', updatePageScale);
            new ResizeObserver(updatePageScale).observe(document.body);
        }

        window.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>
